package config

import (
	"reflect"
	"testing"

	"github.com/spf13/viper"
)

func TestNewServerConfig(t *testing.T) {
	tt := []struct {
		bind string
		port int

		expected ServerConfig
	}{
		{"", 0, ServerConfig{"", 5000}},
		{"127.0.0.1", 8000, ServerConfig{"127.0.0.1", 8000}},
	}

	for _, tc := range tt {
		if tc.bind != "" {
			viper.Set(vServerBind, tc.bind)
		}

		if tc.port != 0 {
			viper.Set(vServerPort, tc.port)
		}

		config := NewServerConfig()

		if !reflect.DeepEqual(tc.expected, config) {
			t.Errorf("want %#v, got %#v", tc.expected, config)
		}
	}
}
